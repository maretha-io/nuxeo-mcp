# Improved File Handling for Nuxeo MCP

This specification outlines the improvements to file handling in the Nuxeo MCP project, particularly for the `seed_nuxeo.py` script.

## Overview

The improvements include:
1. Adding support for generating random images (PNG)
2. Adding support for generating proper PDF documents
3. Creating Picture documents in addition to File documents

## Dependencies

The following dependencies have been added to the project:
- `pillow`: For image generation and manipulation
- `reportlab`: For PDF generation

## Implementation Details

### 1. Random Image Generation

A new utility function has been added to generate random PNG images with various shapes:

```python
def generate_random_image(width: int = 400, height: int = 300) -> bytes:
    """
    Generate a PNG image with random shapes and return it as bytes.
    
    Args:
        width: Width of the image in pixels
        height: Height of the image in pixels
        
    Returns:
        Image data as bytes
    """
    image = Image.new("RGB", (width, height), "white")
    draw = ImageDraw.Draw(image)

    for _ in range(20):  # draw 20 random shapes
        shape_type = random.choice(["line", "ellipse", "rectangle"])
        x0, y0 = random.randint(0, width), random.randint(0, height)
        x1, y1 = random.randint(0, width), random.randint(0, height)
        color = tuple(random.randint(0, 255) for _ in range(3))

        if shape_type == "line":
            draw.line((x0, y0, x1, y1), fill=color, width=2)
        elif shape_type == "ellipse":
            draw.ellipse((x0, y0, x1, y1), outline=color, width=2)
        elif shape_type == "rectangle":
            draw.rectangle((x0, y0, x1, y1), outline=color, width=2)

    buffer = io.BytesIO()
    image.save(buffer, format="PNG")
    return buffer.getvalue()
```

### 2. PDF Generation

A new utility function has been added to generate proper PDF documents with random text:

```python
def generate_random_pdf(num_lines: int = 25) -> bytes:
    """
    Generate a PDF with random text and return it as bytes.
    
    Args:
        num_lines: Number of lines of text to include in the PDF
        
    Returns:
        PDF data as bytes
    """
    buffer = io.BytesIO()
    c = canvas.Canvas(buffer, pagesize=LETTER)
    width, height = LETTER

    for i in range(num_lines):
        x = 50
        y = height - 50 - i * 20
        text = " ".join(random.choices([
            "lorem", "ipsum", "dolor", "sit", "amet", "consectetur",
            "adipiscing", "elit", "sed", "do", "eiusmod", "tempor"
        ], k=random.randint(5, 10)))
        c.drawString(x, y, text)

    c.save()
    return buffer.getvalue()
```

### 3. Updated Document Creation

The `seed_nuxeo_repository` function has been updated to:
- Use the new `generate_random_pdf` function for File documents
- Create a new Picture document with a PNG image generated by `generate_random_image`

## Usage

The `seed_nuxeo.py` script can be run as before:

```bash
python seed_nuxeo.py
```

This will now create:
- A Folder document
- A File document with a proper PDF attachment
- A Note document with random text
- A Picture document with a random PNG image

## Benefits

These improvements provide several benefits:
1. More realistic test data for the Nuxeo repository
2. Better testing of document conversions and renditions
3. Coverage of more document types (Picture in addition to File and Note)
